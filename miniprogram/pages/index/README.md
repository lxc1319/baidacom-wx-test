# 首页开发说明文档

## 概述

首页是物流追踪小程序的核心页面，提供运单查询、订单管理、快捷功能等主要功能入口。

## 功能模块

### 1. 顶部轮播图区域
- **组件**: `banner-swiper`
- **数据来源**: `/com/company-banner/list` 接口
- **功能**:
  - 自动播放（间隔4秒）
  - 循环播放
  - 手势滑动切换
  - 指示点显示（黄色高亮）
  - 点击跳转到物流公司详情页

### 2. 查询输入区域
- **功能**:
  - 手动输入运单号
  - 扫码查询（调用 `wx.scanCode`）
  - 首次使用需要登录
  - 查询结果处理：
    - 未找到：显示提示
    - 单个结果：直接跳转到身份验证页
    - 多个结果：显示选择弹窗
  - 已登录用户自动标记查询历史

### 3. 标签页切换
- **三个标签**:
  - 最近查询：显示用户最近查询的运单
  - 寄件订单：显示用户的寄件订单
  - 收件订单：显示用户的收件订单
- **登录逻辑**:
  - 未登录时可以切换标签
  - 列表显示空状态，不主动弹出登录提示
  - 只在点击运单或收藏时检查登录状态

### 4. 运单列表区域
- **组件**: `waybill-card`
- **功能**:
  - 显示运单关键信息（姓名、地址、日期、状态）
  - 收藏/订阅功能：
    - 未订阅：空心黄色星标（☆ #FFD700）
    - 已订阅：实心红色星标（★ #FF0000）
    - 点击收藏需要登录
  - 点击卡片跳转到身份验证页
  - 下拉刷新
  - 上拉加载更多

### 5. 快捷功能区
- **查优质物流线路**: 跳转到线路查询页面（待实现）
- **网点快捷下单**: 需要登录，跳转到下单页面（待实现）

### 6. 通知公告滚动条
- **数据来源**: `/com/company-notice/page` 接口（获取最新5条）
- **功能**:
  - 垂直滚动显示公告标题
  - 自动播放（间隔3秒）
  - 点击跳转到通知公告列表页

### 7. 广告列表区域
- **数据来源**: `/com/company-banner/list` 接口
- **功能**:
  - 垂直列表展示广告图片
  - 按 `sortNum` 排序
  - 点击跳转到物流公司详情页

## 数据流

### 页面加载流程
1. 检查是否首次使用（从本地存储读取）
2. 并行加载：
   - 轮播图数据
   - 通知公告数据
   - 广告列表数据
3. 根据登录状态和当前标签加载运单列表

### 查询运单流程
1. 用户输入运单号或扫码
2. 检查是否首次使用：
   - 首次使用：弹出登录确认弹窗
   - 用户确认登录 → 执行登录 → 登录成功后查询
   - 用户取消登录 → 标记已使用，不执行查询
3. 非首次使用：直接查询
4. 调用 `/com/waybill/search` 接口
5. 处理查询结果：
   - 0个结果：显示"未找到运单"
   - 1个结果：跳转到身份验证页
   - 多个结果：显示选择弹窗
6. 已登录用户后台自动调用 `/com/waybill/markRecentSearch` 标记历史

### 标签页切换流程
1. 用户点击标签
2. 不检查登录状态，直接切换
3. 清空当前列表，重置分页
4. 调用对应接口加载数据：
   - 最近查询：`/com/waybill/recentSearchPage`
   - 寄件订单：`/com/waybill/sendOrderPage`
   - 收件订单：`/com/waybill/collectOrderPage`
5. 未登录时后端返回空列表，前端显示"暂无数据"

### 收藏/订阅流程
1. 用户点击收藏图标
2. 检查登录状态：
   - 未登录：弹出登录提示
   - 已登录：执行订阅操作
3. 调用 `/com/waybill/subscribe` 接口
4. 更新列表中的订阅状态
5. 显示操作结果提示

## 组件依赖

### 使用的组件
- `banner-swiper`: 轮播图组件
- `waybill-card`: 运单卡片组件
- `waybill-result-modal`: 查询结果弹窗组件

### 服务依赖
- `services/api.js`: API接口封装
- `services/auth.js`: 认证服务
- `services/storage.js`: 本地存储服务

## 样式设计

### 颜色规范
- 主色调：黄色 `#FFD700`（查询按钮、指示点）
- 强调色：红色 `#FF0000`（选中标签、已订阅星标）
- 背景色：`#F5F5F5`（页面背景）
- 卡片背景：`#FFFFFF`
- 文字颜色：
  - 主文字：`#333333`
  - 次要文字：`#666666`
  - 辅助文字：`#999999`

### 布局规范
- 页面内边距：`32rpx`
- 模块间距：`16rpx`
- 卡片圆角：`16rpx`
- 按钮圆角：`32rpx`（查询按钮）、`40rpx`（搜索框）

## 待完成功能

1. **图标资源**: 需要设计师提供以下图标
   - 扫码图标 `scan-icon.png`
   - 线路查询图标 `route-icon.png`
   - 快捷下单图标 `order-icon.png`
   - 通知图标 `notice-icon.png`
   - 右箭头图标 `arrow-right.png`
   - 空状态图标 `empty-icon.png`

2. **功能跳转**:
   - 查优质物流线路：需要实现线路查询页面或小程序跳转
   - 网点快捷下单：需要实现下单页面或小程序跳转

3. **页面依赖**:
   - 身份验证页 `/pages/waybill-verify/waybill-verify`
   - 物流公司详情页 `/pages/company-detail/company-detail`
   - 通知公告列表页 `/pages/notice-list/notice-list`

## 注意事项

1. **首次使用登录逻辑**:
   - 只在首次查询运单时提示登录
   - 用户可以选择取消登录
   - 取消后标记为已使用，后续不再提示

2. **登录状态检查**:
   - 标签页切换：不检查登录
   - 查询运单：首次使用时检查
   - 点击收藏：检查登录
   - 快捷下单：检查登录

3. **收藏图标颜色**:
   - 未订阅：空心黄色星标 `#FFD700`
   - 已订阅：实心红色星标 `#FF0000`
   - 不要搞反颜色！

4. **性能优化**:
   - 轮播图和广告使用同一个接口数据
   - 页面加载时并行请求多个接口
   - 列表支持分页加载，避免一次加载过多数据

## 测试要点

### 功能测试
- [ ] 轮播图自动播放和手势滑动
- [ ] 扫码查询功能
- [ ] 首次使用登录提示
- [ ] 查询结果处理（0个、1个、多个）
- [ ] 标签页切换和数据加载
- [ ] 收藏/订阅功能
- [ ] 下拉刷新和上拉加载
- [ ] 通知公告滚动
- [ ] 广告点击跳转

### 登录状态测试
- [ ] 未登录时标签页切换显示空状态
- [ ] 未登录时点击收藏弹出登录提示
- [ ] 未登录时快捷下单弹出登录提示
- [ ] 登录后自动标记查询历史
- [ ] 登录后订阅功能正常

### 边界情况测试
- [ ] 网络异常时的错误提示
- [ ] 接口返回空数据的处理
- [ ] 图片加载失败的处理
- [ ] 运单号格式验证

## 开发日志

### 2024-01-XX
- ✅ 完成页面整体布局
- ✅ 实现顶部轮播图区域
- ✅ 实现查询输入区域
- ✅ 实现标签页切换
- ✅ 实现运单列表展示
- ✅ 实现快捷功能区
- ✅ 实现通知公告滚动条
- ✅ 实现广告列表区域
- ✅ 实现下拉刷新和上拉加载
- ✅ 集成运单卡片组件
- ✅ 实现收藏/订阅功能
- ✅ 实现首次使用登录逻辑

### 待优化
- [ ] 添加图标资源
- [ ] 实现线路查询功能
- [ ] 实现快捷下单功能
- [ ] 优化加载性能
- [ ] 添加骨架屏加载效果
